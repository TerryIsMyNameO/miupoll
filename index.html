<!DOCTYPE html>
<html>
<head>
<title>Create Poll</title>
</head>
<body>

	<form id="pollForm">
	  <label for="Title">Poll Title*</label><br>
	  <input type="text" id="Title" name="Title" required><br>
	  <label for="Option1">Option*</label><br>
	  <input type="text" id="Option1" name="Option1" required><br>
	  <label for="Option2">Option*</label><br>
	  <input type="text" id="Option2" name="Option2" required><br>
	  <label for="Option3">Option</label><br>
	  <input type="text" id="Option3" name="Option3"><br>
	  <div id="error-message" style="color: red; display: none;">Please fill in all required fields.</div> <!-- Error message placeholder -->
	</form>

	<button onclick="startPoll()">Start Poll</button><button onclick="endPoll()">End Poll</button><button onclick="hideOverlay()">Hide Overlay</button>

<script>
const webhookUrl = getUrlParameter('webhook'); // Get webhook URL from query parameter

function getUrlParameter(name) {
	const urlParams = new URLSearchParams(window.location.search);
	return urlParams.get(name);
} // Get paramaters from url

// Clears html Form
function clearForm(){
	// Access the form element
	var form = document.getElementById("pollForm");

	// Iterate through each input field in the form
	for (var i = 0; i < form.elements.length; i++) {
	  var element = form.elements[i];
	  
	  // Check if the element is an input field
	  if (element.tagName === "INPUT") {
	    // Clear the value of the input field
	    element.value = "";
	  }
	}
}

// Check that the webhook parameter has been included
function checkWebhook(){
    if (!webhookUrl) {
        console.error("Webhook URL is missing.");
        return;
    } // Error if no webhook was included in the url
}

// Send json data to bot
function sendData(jsonData){
    fetch(webhookUrl, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(jsonData),
    })
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error('Error:', error)); // Error handling for the fetch request
}

function startPoll(){
    checkWebhook();

    // Access the form element
    var form = document.getElementById("pollForm");

    // Get poll options from form
    var title = form.elements["Title"].value;
    var options = [];

    // Push non-empty options into the options array
    for (var i = 1; i <= 3; i++) {
        var option = form.elements["Option" + i].value.trim();
        if (option !== "") {
            options.push(option);
        }
    }

    // Check if required fields are filled
    if (title === "" || options.length < 2) {
        // Display error message
        var errorMessage = document.getElementById("error-message");
        errorMessage.style.display = "block";
        return; // Stop function execution if required fields are not filled
    }

    // Format poll options as JSON
    var jsonData = {
        title: title || '',
        option1: options[0] || '',
        option2: options[1] || '',
        extraOpts: options.length -2 || 0,
        option3: options[2] || null, // Include null if option3 is empty
    };

    // Send data to bot
    sendData(jsonData);
}

function endPoll(){
     checkWebhook();

    var jsonData = { endPoll: true, };

    // Send data to bot
    sendData(jsonData);
}

function hideOverlay(){
    checkWebhook();

    var jsonData = { hidePoll: true, };

    // Send data to bot
    sendData(jsonData);
}

</script>

</body>
</html>
